<?xml version="1.0" encoding="UTF-8"?>
 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="dev.mvc.recordgood.RecordgoodDAOInter">
  <!-- 등록 -->
  <insert id="create" parameterType="dev.mvc.recordgood.RecordgoodVO">
    INSERT INTO recordgood(recordgoodno, rdate, recordno, reviewerno)
    VALUES (recordgood_seq.nextval, sysdate, #{recordno}, #{reviewerno})
  </insert>
  
  <!-- 전체 목록 -->
  <select id="list_all" resultType="dev.mvc.recordgood.RecordgoodVO">
    SELECT recordgoodno, rdate, recordno, reviewerno
    FROM recordgood
    ORDER BY recordgoodno DESC
  </select>
  
    <!-- 일반적인 조회 -->
  <select id="read" resultType="dev.mvc.recordgood.RecordgoodVO" parameterType="int">
    SELECT recordgoodno, rdate, recordno, reviewerno
    FROM recordgood
    WHERE recordgoodno = #{recordgoodno}
  </select>  
   
  <!-- 삭제 -->
  <delete id="delete" parameterType="int">
    DELETE FROM recordgood
    WHERE recordgoodno = #{recordgoodno}
  </delete>
  
  <!-- 특정 컨텐츠의 특정 회원 추천 갯수 산출 , 하나의 글에 대하여 중복추천안됨-->
  <select id="hartCnt" resultType="int" parameterType='HashMap'>
    SELECT COUNT(*) as cnt
    FROM recordgood
    WHERE recordno=#{recordno} AND reviewerno=#{reviewerno}
  </select>
  


  <!-- recordno, reviewerno로 조회 -->
  <select id="readByRecordnoReviewerno" resultType="dev.mvc.recordgood.RecordgoodVO" parameterType="HashMap">
    SELECT recordgoodno, rdate, recordno, reviewerno
    FROM recordgood
    WHERE recordno=#{recordno} AND reviewerno=#{reviewerno}
  </select>  

  <!-- 전체 목록, 테이블 3개 join -->
  <select id="list_all_join" resultType="dev.mvc.recordgood.RecordRecordgoodReviewerVO">
    SELECT r.recordgoodno, r.rdate, r.recordno, c.title as c_title, r.reviewerno, m.reviewerid, m.reviewername
    FROM record c, recordgood r, reviewer m
    WHERE c.recordno = r.recordno AND r.reviewerno = m.reviewerno
    ORDER BY recordgoodno DESC
  </select>
      
</mapper>